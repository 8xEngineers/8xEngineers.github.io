!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).tinyfoot={})}(this,(function(t){"use strict";var e=function(){return e=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},e.apply(this,arguments)};"function"==typeof SuppressedError&&SuppressedError;var n,r={};function o(){if(n)return r;return n=1,Object.defineProperty(r,"__esModule",{value:!0}),r.getStyle=function(t,e){var n,r=((null===(n=t.ownerDocument)||void 0===n?void 0:n.defaultView)||window).getComputedStyle(t);return r.getPropertyValue(e)||r[e]},r}var i,u=o(),a={};function c(){if(i)return a;i=1,Object.defineProperty(a,"__esModule",{value:!0}),a.pixels=function t(o,i){var a,l,s=null!==(l=null===(a=null==i?void 0:i.ownerDocument)||void 0===a?void 0:a.defaultView)&&void 0!==l?l:window,f=s.document.documentElement||s.document.body,d=function(t){var e,n=t||"0",r=Number.parseFloat(n),o=n.match(/[\d-.]+(\w+)$/),i=null!==(e=null==o?void 0:o[1])&&void 0!==e?e:"";return[r,i.toLowerCase()]}(o),v=d[0];switch(d[1]){case"rem":return v*t(c(window.document.documentElement));case"em":return v*t(c(i),null==i?void 0:i.parentElement);case"in":return v*e;case"q":return v*e/n/4;case"mm":return v*e/n;case"cm":return v*e*10/n;case"pt":return v*e/r;case"pc":return v*e/u;case"vh":return(v*s.innerHeight||f.clientWidth)/100;case"vw":return(v*s.innerWidth||f.clientHeight)/100;case"vmin":return v*Math.min(s.innerWidth||f.clientWidth,s.innerHeight||f.clientHeight)/100;case"vmax":return v*Math.max(s.innerWidth||f.clientWidth,s.innerHeight||f.clientHeight)/100;default:return v}};var t=o(),e=96,n=25.4,r=72,u=6;function c(e){return e?(0,t.getStyle)(e,"fontSize")||c(e.parentElement):(0,t.getStyle)(window.document.documentElement,"fontSize")}return a}var l=c(),s="tinyfoot__tooltip";function f(t){var e=Number.parseFloat(u.getStyle(t,"marginLeft")),n=t.offsetWidth-e;return(t.getBoundingClientRect().left+n/2)/window.innerWidth}function d(t,e,n){var r=function(t,e){var n=Number.parseInt(u.getStyle(e,"marginTop"),10),r=2*n+e.offsetHeight,o=t.getBoundingClientRect().top+t.offsetHeight/2,i=window.innerHeight-o;return i>=r||i>=o?["below",i-n-15]:["above",o-n-15]}(e,t),o=r[0],i=r[1];if(n!==o){t.classList.remove("is-"+n),t.classList.add("is-"+o);var a=100*f(e)+"%",c="above"===o?"100%":"0";t.style.transformOrigin=a+" "+c}return[o,i]}var v="is-active",m="is-changing",p="is-scrollable";function h(t){var e=t.id,n=t.button,r=t.content,o=t.host,i=t.popover,a=t.wrapper,c=0,h="above",g=null,y=function(){return document.body.contains(i)},b=function(){var t=document.createElement("button");return t.textContent="Copy",t.className="copy-button",t.onclick=function(){return t=r.textContent||"",void navigator.clipboard.writeText(t).then((function(){console.log("Footnote copied to clipboard!")})).catch((function(t){console.error("Could not copy text: ",t)}));var t},i.appendChild(t),t};return{id:e,activate:function(t){var e;n.setAttribute("aria-expanded","true"),n.classList.add(m),n.classList.add(v),n.insertAdjacentElement("afterend",i),i.style.maxWidth=document.body.clientWidth+"px",e=r,c=Math.round(l.pixels(u.getStyle(e,"maxHeight"),e)),g=b(),null==t||t(i,n)},dismiss:function(t){n.setAttribute("aria-expanded","false"),n.classList.add(m),n.classList.remove(v),i.classList.remove(v),g&&(g.remove(),g=null),null==t||t(i,n)},isActive:function(){return n.classList.contains(v)},isReady:function(){return!n.classList.contains(m)},ready:function(){i.classList.add(v),n.classList.remove(m)},remove:function(){i.remove(),n.classList.remove(m)},reposition:function(){if(y()){var t=d(i,n,h),e=t[0],o=t[1];h=e,r.style.maxHeight=Math.min(c,o)+"px",i.offsetHeight<r.scrollHeight?(i.classList.add(p),r.setAttribute("tabindex","0")):(i.classList.remove(p),r.removeAttribute("tabindex"))}},resize:function(){y()&&(i.style.left=function(t,e){var n=t.offsetWidth;return-f(e)*n+Number.parseInt(u.getStyle(e,"marginLeft"),10)+e.offsetWidth/2}(r,n)+"px",a.style.maxWidth=r.offsetWidth+"px",function(t,e){var n=t.querySelector("."+s);n&&(n.style.left=100*f(e)+"%")}(i,n))},destroy:function(){return o.remove()}}}var g,y={};function b(){if(g)return y;return g=1,Object.defineProperty(y,"__esModule",{value:!0}),y.throttle=function(t,e){void 0===e&&(e=0);var n,r=0;return Object.assign((function(){for(var o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];var u=Math.max(0,r+e-Date.now());u?(clearTimeout(n),n=setTimeout((function(){r=Date.now(),t.apply(void 0,o)}),u)):(r=Date.now(),t.apply(void 0,o))}),{cancel:function(){r=0,clearTimeout(n)}})},y}var w=b(),E="is-fully-scrolled",x=function(t){return function(e){var n=e.currentTarget,r=-e.deltaY;r>0&&t.classList.remove(E),n&&r<=0&&r<n.clientHeight+n.scrollTop-n.scrollHeight&&t.classList.add(E)}};var L="tinyfoot__content",S="tinyfoot__wrapper",A="tinyfoot--print",D=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.forEach((function(t){return t.classList.add(A)}))};function H(t,e){return Array.from(t.querySelectorAll(e))}function T(t,e){return t.querySelector("."+e)||t.firstElementChild||t}function C(t){var e=document.createElement("div");e.innerHTML=t;var n=e.firstElementChild;return n.remove(),n}function _(t){return void 0!==t}function M(t){var e=t.parentElement,n=H(e,":scope > :not(."+A+")"),r=n.filter((function(t){return"HR"===t.tagName}));n.length===r.length&&(D.apply(void 0,r.concat(e)),M(e))}function O(t,e){var n=t.parentElement;t.remove(),n&&n!==e&&!n.innerHTML.replace(/(\[\]|&nbsp;|\s)/g,"")&&O(n,e)}function W(t,e){var n=t[0],r=t[1],o=t[2],i=C(o.outerHTML);H(i,'[href$="#'+n+'"]').forEach((function(t){return O(t,i)}));var u=i.innerHTML.trim();return[r,o,{id:String(e+1),number:e+1,reference:"lf-"+n,content:u.startsWith("<")?u:"<p>"+u+"</p>"}]}function k(t){return function(e){return t.replace(/<%=?\s*(\w+?)\s*%>/g,(function(t,n){var r;return String(null!==(r=e[n])&&void 0!==r?r:"")}))}}function P(t,e){var n=k(t),r=k(e);return function(t){var e=t[0],o=t[1],i=o.id,u=C('<span class="tinyfoot">'+n(o)+"</span>"),a=u.firstElementChild;a.setAttribute("aria-expanded","false"),a.setAttribute("highlight-toggled","false"),a.dataset.footnoteButton="",a.dataset.footnoteId=i;var c=C(r(o));c.dataset.footnotePopover="",c.dataset.footnoteId=i;var l=T(c,S),s=T(c,L);return function(t,e){t.addEventListener("wheel",w.throttle(x(e),16))}(s,c),e.insertAdjacentElement("beforebegin",u),{id:i,button:a,host:u,popover:c,content:s,wrapper:l}}}function j(t){var n,r,o,i=t.allowDuplicates,u=t.anchorParentSelector,a=t.anchorPattern,c=t.buttonTemplate,l=t.contentTemplate,s=t.footnoteSelector,f=t.numberResetSelector,d=t.scope,v=function(t,e,n){return H(t,n+' a[href*="#"]').filter((function(t){return(t.href+t.rel).match(e)}))}(document,a,d),m=function(t,e,n,r){var o=[];return function(i){var u,a=i.href.split("#")[1];if(a){var c=null===(u=H(t,"#"+window.CSS.escape(a)).find((function(t){return e||!o.includes(t)})))||void 0===u?void 0:u.closest(r);if(c){o.push(c);var l=i.closest(n)||i;return[l.id||i.id,l,c]}}}}(document,i,u,s),p=v.map(m).filter(_).map(W),g=f?(n=f,r=0,o=null,function(t){var i=t[0],u=t[1],a=t[2],c=i.closest(n);return r=o===c?r+1:1,o=c,[i,u,e(e({},a),{number:r})]}):function(t){return t},y=p.map(g).map((function(t){var e=t[0],n=t[1],r=t[2];return D(e,n),M(n),[e,r]})),b=P(c,l),w=y.map((function(t){var e=t[0],n=t[1];return e instanceof Element&&void 0!==n&&"number"in n&&"id"in n&&"content"in n&&"reference"in n?b([e,n]):null})).filter((function(t){return null!==t})),E=w.map(h);return{footnotes:E,unmount:function(){E.forEach((function(t){return t.destroy()})),H(document,"."+A).forEach((function(t){return t.classList.remove(A)}))}}}var R="[data-footnote-id]",z=function(t,e){return t.target.closest(e)},F=function(t){return null==t?void 0:t.dataset.footnoteId},N=function(t){return function(e){e.preventDefault();var n=z(e,R),r=F(n);r&&t(r)}},I=document.addEventListener,q=window.addEventListener,B=function(t,e,n,r){return I(t,(function(t){var r=t.target;(null==r?void 0:r.closest(e))&&n.call(r,t)}),r)};var V={activateDelay:100,activateOnHover:!1,allowDuplicates:!0,allowMultiple:!1,anchorParentSelector:"sup",anchorPattern:/(fn|footnote|note)[:\-_\d]/gi,dismissDelay:100,dismissOnUnhover:!1,dismissOnDocumentTouch:!0,footnoteSelector:"li",hoverDelay:250,numberResetSelector:"",scope:"",contentTemplate:'<aside class="tinyfoot__popover" id="fncontent:<% id %>"><div class="'.concat(S,'"><div class="').concat(L,'"><% content %></div></div><div class="').concat(s,'"></div></aside>'),buttonTemplate:'<button class="tinyfoot__button" id="<% reference %>" title="See Footnote <% number %>"><svg role="img" aria-labelledby="title-<% reference %>" viewbox="0 0 31 6" preserveAspectRatio="xMidYMid"><title id="title-<% reference %>">Footnote <% number %></title><circle r="3" cx="3" cy="3" fill="white"></circle><circle r="3" cx="15" cy="3" fill="white"></circle><circle r="3" cx="27" cy="3" fill="white"></circle></svg></button>'};function U(t){void 0===t&&(t={});var n=e(e({},V),t),r=function(t,e){var n,r=t.footnotes,o=t.unmount,i=function(t){return function(n){n.isReady()&&(n.dismiss(e.dismissCallback),setTimeout(n.remove,t))}},u=function(t){return function(n){e.allowMultiple||r.filter((function(t){return t.id!==n.id})).forEach(i(e.dismissDelay)),n.isReady()&&(n.activate(e.activateCallback),n.reposition(),n.resize(),setTimeout(n.ready,t))}},a=function(t){return function(e){var n=r.find((function(t){return t.id===e}));n&&t(n)}},c=function(){return r.forEach(i(e.dismissDelay))};return{activate:function(t,e){return a(u(e))(t)},dismiss:function(t,e){return a(i(e))(t)},dismissAll:c,touchOutside:function(){e.dismissOnDocumentTouch&&c()},repositionAll:function(){return r.forEach((function(t){return t.reposition()}))},resizeAll:function(){return r.forEach((function(t){return t.resize()}))},toggle:a((function(t){return t.isActive()?i(e.dismissDelay)(t):u(e.activateDelay)(t)})),hover:a((function(t){n=t.id,e.activateOnHover&&!t.isActive()&&u(e.hoverDelay)(t)})),unhover:a((function(t){t.id===n&&(n=null),e.dismissOnUnhover&&setTimeout((function(){return r.filter((function(t){return t.id!==n})).forEach(i(e.dismissDelay))}),e.hoverDelay)})),unmount:o}}(j(n),n),o=function(t){var e=function(e){var n=z(e,"[data-footnote-button]"),r=F(n);r?(e.preventDefault(),t.toggle(r)):z(e,"[data-footnote-popover]")||t.touchOutside()},n=w.throttle(t.repositionAll,16),r=w.throttle(t.resizeAll,16),o=N(t.hover),i=N(t.unhover),u=new AbortController,a={signal:u.signal};return I("touchend",e,a),I("click",e,a),I("dblclick",(function(t){var e=z(t,"[data-footnote-button]");if(e){var n=e.getAttribute("highlight-toggled");console.log(n),"false"===n?(e.style.backgroundColor="#FFD700",e.setAttribute("highlight-toggled","true")):(e.style.backgroundColor="#949494",e.setAttribute("highlight-toggled","false"))}}),a),I("keyup",(function(e){27!==e.keyCode&&"Escape"!==e.key&&"Esc"!==e.key||t.dismissAll()}),a),I("gestureend",n,a),q("scroll",n,a),q("resize",r,a),B("mouseover",R,o,a),B("mouseout",R,i,a),function(){u.abort()}}(r);return{activate:function(t,e){void 0===e&&(e=n.activateDelay),r.activate(t,e)},dismiss:function(t,e){void 0===e&&(e=n.dismissDelay),void 0===t?r.dismissAll():r.dismiss(t,e)},unmount:function(){o(),r.unmount()},getSetting:function(t){return n[t]},updateSetting:function(t,e){n[t]=e}}}t.default=U,t.tinyfoot=U,Object.defineProperty(t,"__esModule",{value:!0})}));
